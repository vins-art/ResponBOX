<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>RESPON BOX - SAW Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background: #f3f8ff;
        margin: 0;
    }

    /* HEADER */
    header {
        background: #75b4ff;
        color: white;
        padding: 12px 20px;
        font-size: 18px;
        font-weight: 600;
    }

    /* CONTAINERS */
    .container {
        max-width: 900px;
        margin: 25px auto;
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0px 3px 10px rgba(0,0,0,0.08);
    }

    h2 {
        color: #3d6eb8;
        margin-bottom: 10px;
    }

    input, select, textarea {
        width: 100%;
        padding: 10px;
        margin: 6px 0 15px;
        border-radius: 8px;
        border: 1px solid #cbd9ff;
        background: #f8fbff;
    }

    button {
        background: #75b4ff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
    }

    button:hover {
        background: #599dff;
    }

    .logoutBtn {
        background: #ff6b6b !important;
        padding: 8px 14px !important;
        float: right;
        margin-top: -5px;
    }

    /* TABLE */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    th, td {
        padding: 10px;
        border-bottom: 1px solid #e5edff;
    }

    th {
        background: #e8f1ff;
        color: #3d6eb8;
    }

    .statusBox {
        background: #e8f1ff;
        padding: 10px;
        border-radius: 8px;
        margin: 5px 0;
        font-size: 15px;
        color: #3d6eb8;
    }

    .flex-row {
        display: flex;
        gap: 15px;
        margin-top: 15px;
    }

    .card {
        flex: 1;
        background: #f8fbff;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        border: 1px solid #d6e4ff;
    }

    .hidden { display: none; }
</style>
</head>

<body>

<header>
    RESPON BOX — SAW DEMO
    <button class="logoutBtn hidden" id="logoutBtn" onclick="logout()">Logout</button>
</header>


<!-- LOGIN PAGE -->
<div id="loginPage" class="container">
    <h2>Login</h2>
    <p>Username (NIM atau NIDN/NUPTK Anda)</p>
    <input id="loginUser" type="text">

    <p>Password</p>
    <input id="loginPass" type="password">

    <button onclick="login()">Masuk</button>

    <br><br>
    <p>Belum punya akun mahasiswa?</p>
    <button onclick="showPage('regPage')">Registrasi Mahasiswa</button>
</div>



<!-- REGISTRASI -->
<div id="regPage" class="container hidden">
    <h2>Registrasi Mahasiswa</h2>

    <p>Nama Lengkap</p>
    <input id="regNama">

    <p>NIM</p>
    <input id="regNim">

    <p>Kelas</p>
    <input id="regKelas">

    <p>Tempat, Tanggal Lahir</p>
    <input id="regTTL">

    <p>Password</p>
    <input id="regPass" type="password">

    <button onclick="registerMahasiswa()">Daftar</button>
    <button onclick="showPage('loginPage')">Kembali</button>
</div>



<!-- DASHBOARD MAHASISWA -->
<div id="mahasiswaDashboard" class="container hidden">
    <h2 id="mhsGreeting">Halo, Mahasiswa</h2>
    <p id="mhsNimDisplay"></p>

    <hr><br>

    <h3>Buat Laporan Baru</h3>
    <p>Judul Laporan</p>
    <input id="lapJudul">

    <p>Kategori</p>
    <select id="lapKategori">
        <option value="Kerusakan Fasilitas">Kerusakan Fasilitas</option>
        <option value="Kebersihan">Kebersihan</option>
        <option value="Administrasi">Administrasi</option>
    </select>

    <p>Deskripsi Laporan</p>
    <textarea id="lapDeskripsi"></textarea>

    <button onclick="buatLaporan()">Kirim Laporan</button>

    <br><br><hr><br>

    <h3>Riwayat Laporan Anda</h3>

    <table id="tableMhs">
        <tr>
            <th>Judul</th><th>Kategori</th><th>Status</th>
        </tr>
    </table>
</div>



<!-- DASHBOARD ADMIN -->
<div id="adminDashboard" class="container hidden">
    <h2>Dashboard Admin</h2>

    <div class="statusBox">Laporan Baru: <span id="admBaru">0</span></div>
    <div class="statusBox">Diproses: <span id="admProses">0</span></div>
    <div class="statusBox">Selesai Hari Ini: <span id="admDone">0</span></div>

    <h3>Semua Laporan (SAW Filtering Otomatis)</h3>
    <table id="adminTable">
        <tr>
            <th>Pelapor</th><th>Judul</th><th>Kategori</th><th>Status</th>
        </tr>
    </table>
</div>



<!-- DASHBOARD PIMPINAN -->
<div id="pimpinanDashboard" class="container hidden">
    <h2>Dashboard Pimpinan</h2>

    <div class="flex-row">
        <div class="card">Total Laporan<br><b id="pTotal">0</b></div>
        <div class="card">Baru<br><b id="pBaru">0</b></div>
        <div class="card">Diproses<br><b id="pProses">0</b></div>
        <div class="card">Selesai<br><b id="pSelesai">0</b></div>
    </div>

    <br><br>
    <h3>Tren Kerusakan (30 Hari) — Dummy</h3>
    <div class="card">[Diagram Placeholder]</div>

    <br>
    <h3>Rekap Kategori Terbanyak (30 Hari)</h3>
    <div class="card">[Rekap Placeholder]</div>

    <br>
    <button>Export PDF</button>
    <button>Export CSV</button>
</div>

<script>
/* ================================
   NAVIGATION
================================== */
function showPage(page){
    document.querySelectorAll(".container").forEach(c => c.classList.add("hidden"));
    document.getElementById(page).classList.remove("hidden");

    // tampilkan tombol logout jika bukan halaman login/regis
    if (page === "loginPage" || page === "regPage"){
        document.getElementById("logoutBtn").classList.add("hidden");
    } else {
        document.getElementById("logoutBtn").classList.remove("hidden");
    }
}



/* ================================
   REGISTRASI MAHASISWA
================================== */
function registerMahasiswa(){
    const mhsList = JSON.parse(localStorage.getItem("mahasiswaList")) || [];

    const data = {
        nama: document.getElementById("regNama").value,
        nim: document.getElementById("regNim").value,
        kelas: document.getElementById("regKelas").value,
        ttl: document.getElementById("regTTL").value,
        password: document.getElementById("regPass").value
    };

    mhsList.push(data);
    localStorage.setItem("mahasiswaList", JSON.stringify(mhsList));

    alert("Registrasi Berhasil!");
    showPage("loginPage");
}



/* ================================
   LOGIN
================================== */
function login(){
    const user = loginUser.value.trim();
    const pass = loginPass.value.trim();

    const admin = { user:"admin", pass:"admin123", role:"admin" };
    const pimpinan = { user:"pimpinan", pass:"pimpinan123", role:"pimpinan" };

    if(user === admin.user && pass === admin.pass){
        localStorage.setItem("loggedUser", JSON.stringify(admin));
        showAdmin();
        return;
    }

    if(user === pimpinan.user && pass === pimpinan.pass){
        localStorage.setItem("loggedUser", JSON.stringify(pimpinan));
        showPimpinan();
        return;
    }

    const list = JSON.parse(localStorage.getItem("mahasiswaList")) || [];
    const mhs = list.find(m => m.nim === user && m.password === pass);

    if(mhs){
        localStorage.setItem("loggedUser", JSON.stringify({
            role:"mahasiswa",
            nama:mhs.nama,
            nim:mhs.nim
        }));
        showMahasiswa(mhs);
        return;
    }

    alert("Login gagal.");
}



/* ================================
   DASHBOARD MAHASISWA
================================== */
function showMahasiswa(m){
    document.getElementById("mhsGreeting").innerHTML = "Halo, " + m.nama;
    document.getElementById("mhsNimDisplay").innerHTML = "NIM: " + m.nim;
    loadLaporanMahasiswa(m.nim);
    showPage("mahasiswaDashboard");
}

function buatLaporan(){
    const list = JSON.parse(localStorage.getItem("laporanList")) || [];

    const pelapor = JSON.parse(localStorage.getItem("loggedUser"));
    const anon = pelapor.nim.substring(0,6) + "******";

    list.push({
        nim: pelapor.nim,
        anon: anon,
        judul: lapJudul.value,
        kategori: lapKategori.value,
        deskripsi: lapDeskripsi.value,
        status: "Baru"
    });

    localStorage.setItem("laporanList", JSON.stringify(list));
    alert("Laporan berhasil dikirim!");
    loadLaporanMahasiswa(pelapor.nim);
}

function loadLaporanMahasiswa(nim){
    const list = JSON.parse(localStorage.getItem("laporanList")) || [];
    const table = document.getElementById("tableMhs");

    table.innerHTML = `
        <tr><th>Judul</th><th>Kategori</th><th>Status</th></tr>
    `;

    list.filter(l => l.nim === nim).forEach(l => {
        table.innerHTML += `
            <tr>
                <td>${l.judul}</td>
                <td>${l.kategori}</td>
                <td>${l.status}</td>
            </tr>
        `;
    });
}



/* ================================
   DASHBOARD ADMIN
================================== */
function showAdmin(){
    loadAdminData();
    showPage("adminDashboard");
}

function loadAdminData(){
    const list = JSON.parse(localStorage.getItem("laporanList")) || [];

    document.getElementById("admBaru").innerText = list.filter(l => l.status=="Baru").length;
    document.getElementById("admProses").innerText = list.filter(l => l.status=="Proses").length;
    document.getElementById("admDone").innerText = list.filter(l => l.status=="Selesai").length;

    const tbl = document.getElementById("adminTable");
    tbl.innerHTML = `
        <tr><th>Pelapor</th><th>Judul</th><th>Kategori</th><th>Status</th></tr>
    `;

    list.forEach(l => {
        tbl.innerHTML += `
            <tr>
                <td>${l.anon}</td>
                <td>${l.judul}</td>
                <td>${l.kategori}</td>
                <td>${l.status}</td>
            </tr>
        `;
    });
}



/* ================================
   DASHBOARD PIMPINAN
================================== */
function showPimpinan(){
    const list = JSON.parse(localStorage.getItem("laporanList")) || [];

    pTotal.innerText = list.length;
    pBaru.innerText = list.filter(l => l.status=="Baru").length;
    pProses.innerText = list.filter(l => l.status=="Proses").length;
    pSelesai.innerText = list.filter(l => l.status=="Selesai").length;

    showPage("pimpinanDashboard");
}



/* ================================
   LOGOUT
================================== */
function logout(){
    localStorage.removeItem("loggedUser");
    showPage("loginPage");
}
</script>

</body>
</html>
