<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>RESPON BOX – SAW Demo</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ===============================================
   THEME — SOFT PASTEL BLUE
   =============================================== */
body {
    font-family: "Segoe UI", sans-serif;
    background: #e7f1ff;
    margin: 0;
    padding: 0;
}

.header {
    background: #4c8df5;
    padding: 12px 20px;
    color: white;
    font-size: 18px;
    font-weight: 600;
}

.container {
    width: 92%;
    max-width: 780px;
    background: white;
    margin: 20px auto;
    padding: 22px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(76,141,245,0.25);
}

h2, h3 {
    color: #4c8df5;
    font-weight: 600;
    margin-top: 0;
}

input, select, textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #cbdcff;
    border-radius: 8px;
    margin-top: 6px;
}

button {
    background: #4c8df5;
    color: white;
    border: none;
    padding: 9px 18px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    display: inline-block;
}

button:hover { background: #3b7ae0; }

.btn-logout {
    float: right;
    background: #ff5757;
    padding: 7px 16px;
}
.btn-logout:hover { background: #e64545; }

.hidden { display: none; }

/* TABLE */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 14px;
}

th {
    background: #4c8df5;
    color: white;
    padding: 8px;
    border-radius: 4px;
}

td {
    background: #ffffff;
    padding: 8px;
    border-bottom: 1px solid #d5e2ff;
}

/* STATUS BOX */
.statusBox {
    display: flex;
    gap: 14px;
    flex-wrap: wrap;
}
.statusItem {
    padding: 10px 16px;
    background: #f5f9ff;
    border: 1px solid #cbdcff;
    border-radius: 8px;
    font-weight: 600;
    color: #4c8df5;
}
</style>

</head>
<body>


<!-- ===================== LOGIN ===================== -->
<div id="pageLogin" class="container">
    <h2>Login</h2>

    <label>Username</label>
    <input id="loginUser">

    <label>Password</label>
    <input id="loginPass" type="password">

    <button onclick="login()">Masuk</button>

    <p style="margin-top:10px;">
        Belum punya akun?
        <a href="#" onclick="show('pageRegister')">Registrasi Mahasiswa</a>
    </p>
</div>


<!-- ===================== REGISTRASI ===================== -->
<div id="pageRegister" class="container hidden">
    <h2>Registrasi Mahasiswa</h2>

    <label>Nama</label>
    <input id="rNama">

    <label>NIM</label>
    <input id="rNIM">

    <label>Kelas</label>
    <input id="rKelas">

    <label>TTL</label>
    <input id="rTTL">

    <label>Password</label>
    <input id="rPass" type="password">

    <button onclick="register()">Daftar</button>
</div>


<!-- ===================== DASHBOARD MAHASISWA ===================== -->
<div id="pageMhs" class="hidden">
    <div class="header">
        Dashboard Mahasiswa
        <button class="btn-logout" onclick="logout()">Logout</button>
    </div>

    <div class="container">
        <h3>Buat Laporan</h3>

        <label>Kategori</label>
        <select id="mKat">
            <option>Kerusakan Ruangan</option>
            <option>Kerusakan Peralatan</option>
            <option>Kebersihan</option>
        </select>

        <label>Lokasi</label>
        <input id="mLok">

        <label>Deskripsi</label>
        <textarea id="mDesk"></textarea>

        <button onclick="buatLaporan()">Kirim Laporan</button>
    </div>

    <div class="container">
        <h3>Riwayat Laporan</h3>
        <table id="tblMhs"></table>
    </div>
</div>


<!-- ===================== DASHBOARD ADMIN ===================== -->
<div id="pageAdmin" class="hidden">
    <div class="header">
        Dashboard Admin
        <button class="btn-logout" onclick="logout()">Logout</button>
    </div>

    <div class="container">
        <h3>Filter</h3>

        <label>Kategori</label>
        <select id="fKat" onchange="loadAdmin()">
            <option value="">Semua</option>
            <option>Kerusakan Ruangan</option>
            <option>Kerusakan Peralatan</option>
            <option>Kebersihan</option>
        </select>

        <label>Status</label>
        <select id="fStat" onchange="loadAdmin()">
            <option value="">Semua</option>
            <option>Baru</option>
            <option>Diproses</option>
            <option>Selesai</option>
        </select>
    </div>

    <div class="container">
        <h3>Status Laporan</h3>
        <div id="statAdmin" class="statusBox"></div>

        <table id="tblAdmin"></table>
    </div>
</div>


<!-- ===================== DASHBOARD PIMPINAN ===================== -->
<div id="pagePimp" class="hidden">
    <div class="header">
        Dashboard Pimpinan
        <button class="btn-logout" onclick="logout()">Logout</button>
    </div>

    <div class="container">
        <h3>Status Laporan</h3>
        <div id="statPimp" class="statusBox"></div>
    </div>

    <div class="container">
        <h3>Tren 30 Hari</h3>
        <canvas id="chart"></canvas>
    </div>

    <div class="container">
        <h3>Rekap Kategori</h3>
        <table id="tblRekap"></table>
    </div>
</div>



<!-- ===============================================================
                     JAVASCRIPT SYSTEM
=============================================================== -->
<script>

let users = JSON.parse(localStorage.getItem("users") || "[]");
let laporan = JSON.parse(localStorage.getItem("laporan") || "[]");
let session = localStorage.getItem("session");

const adminAcc = { user:"admin", pass:"admin" };
const pimpAcc  = { user:"pimpinan", pass:"pimpinan" };

function save(){
    localStorage.setItem("users", JSON.stringify(users));
    localStorage.setItem("laporan", JSON.stringify(laporan));
}

function show(id){
    document.querySelectorAll("div[id^='page']").forEach(x=>x.classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
}


/* =================== REGISTRASI =================== */
function register(){
    users.push({
        username: rNIM.value,
        password: rPass.value,
        nama: rNama.value,
        nim: rNIM.value,
        kelas: rKelas.value,
        ttl: rTTL.value,
        role: "mhs"
    });

    save();
    alert("Registrasi berhasil!");
    show("pageLogin");
}


/* =================== LOGIN =================== */
function login(){
    let u = loginUser.value, p = loginPass.value;

    if (u===adminAcc.user && p===adminAcc.pass){
        session = "admin";
        localStorage.setItem("session","admin");
        show("pageAdmin");
        return loadAdmin();
    }

    if (u===pimpAcc.user && p===pimpAcc.pass){
        session = "pimp";
        localStorage.setItem("session","pimp");
        show("pagePimp");
        return loadPimp();
    }

    let m = users.find(x=>x.username===u && x.password===p);
    if (m){
        session = m.username;
        localStorage.setItem("session", m.username);
        show("pageMhs");
        return loadMhs();
    }

    alert("Username atau password salah.");
}


/* =================== LOGOUT =================== */
function logout(){
    localStorage.removeItem("session");
    show("pageLogin");
}


/* =================== MAHASISWA =================== */
function buatLaporan(){
    laporan.push({
        kategori: mKat.value,
        lokasi: mLok.value,
        desk: mDesk.value,
        status: "Baru",
        created: new Date().toISOString(),

        // Nilai acak untuk simulasi SAW
        c1: Math.floor(Math.random()*5)+1,
        c2: Math.floor(Math.random()*5)+1,
        c3: Math.floor(Math.random()*5)+1,
    });

    save();
    loadMhs();
    alert("Laporan berhasil dikirim!");
}

function loadMhs(){
    let tbl = "<tr><th>#</th><th>Kategori</th><th>Lokasi</th><th>Status</th></tr>";
    laporan.forEach((l,i)=>{
        tbl += `<tr>
            <td>${i+1}</td>
            <td>${l.kategori}</td>
            <td>${l.lokasi}</td>
            <td>${l.status}</td>
        </tr>`;
    });
    document.getElementById("tblMhs").innerHTML = tbl;
}


/* =================== SAW =================== */
function hitungSAW(){
    if (laporan.length===0) return [];

    let max1 = Math.max(...laporan.map(l=>l.c1));
    let max2 = Math.max(...laporan.map(l=>l.c2));
    let max3 = Math.max(...laporan.map(l=>l.c3));

    let w1=0.5, w2=0.3, w3=0.2;

    return laporan.map(l=>{
        let score = ((l.c1/max1)*w1 + (l.c2/max2)*w2 + (l.c3/max3)*w3).toFixed(3);
        return {...l, score};
    }).sort((a,b)=>b.score-a.score);
}


/* =================== ADMIN =================== */
function ubahStatus(i, val){
    laporan[i].status = val;
    save();
    loadAdmin();
}

function loadAdmin(){
    let data = hitungSAW();
    let fk = fKat.value;
    let fs = fStat.value;

    if (fk) data = data.filter(l=>l.kategori===fk);
    if (fs) data = data.filter(l=>l.status===fs);

    let totalBaru = data.filter(l=>l.status==="Baru").length;
    let totalPro = data.filter(l=>l.status==="Diproses").length;
    let totalSls = data.filter(l=>l.status==="Selesai").length;

    document.getElementById("statAdmin").innerHTML = `
        <div class="statusItem">Baru: ${totalBaru}</div>
        <div class="statusItem">Diproses: ${totalPro}</div>
        <div class="statusItem">Selesai: ${totalSls}</div>
    `;

    let tbl = `
        <tr>
            <th>#</th>
            <th>Kategori</th>
            <th>Lokasi</th>
            <th>Skor</th>
            <th>Aksi</th>
        </tr>
    `;

    data.forEach((l,i)=>{
        tbl += `
        <tr>
            <td>${i+1}</td>
            <td>${l.kategori}</td>
            <td>${l.lokasi}</td>
            <td>${l.score}</td>
            <td>
                <select onchange="ubahStatus(${i}, this.value)">
                    <option ${l.status==="Baru"?"selected":""}>Baru</option>
                    <option ${l.status==="Diproses"?"selected":""}>Diproses</option>
                    <option ${l.status==="Selesai"?"selected":""}>Selesai</option>
                </select>
            </td>
        </tr>`;
    });

    document.getElementById("tblAdmin").innerHTML = tbl;
}


/* =================== PIMPINAN =================== */
function loadPimp(){
    let baru = laporan.filter(l=>l.status==="Baru").length;
    let pro  = laporan.filter(l=>l.status==="Diproses").length;
    let sls  = laporan.filter(l=>l.status==="Selesai").length;

    document.getElementById("statPimp").innerHTML = `
        <div class="statusItem">Baru: ${baru}</div>
        <div class="statusItem">Diproses: ${pro}</div>
        <div class="statusItem">Selesai: ${sls}</div>
    `;

    let rekap = {};
    laporan.forEach(l=>{
        rekap[l.kategori] = (rekap[l.kategori]||0)+1;
    });

    let tbl = "<tr><th>Kategori</th><th>Jumlah</th></tr>";
    for (let k in rekap){
        tbl += `<tr><td>${k}</td><td>${rekap[k]}</td></tr>`;
    }
    document.getElementById("tblRekap").innerHTML = tbl;

    loadChart();
}

function loadChart(){
    let perTanggal = {};
    laporan.forEach(l=>{
        let t = l.created.split("T")[0];
        perTanggal[t] = (perTanggal[t]||0)+1;
    });

    new Chart(document.getElementById("chart"), {
        type:"line",
        data:{
            labels:Object.keys(perTanggal),
            datasets:[{
                label:"Jumlah laporan",
                data:Object.values(perTanggal),
                borderColor:"#4c8df5",
                backgroundColor:"rgba(76,141,245,0.2)",
                borderWidth: 2,
                tension: 0.3
            }]
        }
    });
}

</script>
</body>
</html>
